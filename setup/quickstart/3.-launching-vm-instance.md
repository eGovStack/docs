---
description: Launching the VM/Instance with k3d dependencies using Terraform
---

# 3. Launching VM/Instance

## Pre-read:

&#x20;     Know what is terraform: [https://youtu.be/h970ZBgKINg](https://youtu.be/h970ZBgKINg)



## Prerequisites <a href="#prerequisites" id="prerequisites"></a>

1. Install [**terraform**](https://releases.hashicorp.com/terraform/0.14.10/) version (0.14.10) for the Infra-as-code (IaC) to provision cloud resources as code and with desired resource graph and also it helps to destroy the cluster at one go.
   1. If you already have a different version of the terraform version running install [tfswitch](https://github.com/warrensbox/terraform-switcher) that would allow you to have multiple terraform version in the same machine and toggle between the desired versions.
2. [3.-setup-aws-account.md](../install-on-cloud/on-aws/3.-setup-aws-account.md "mention")



### Launching VM/Instance using Terraform

1. Clone the following [DIGIT Devops GitRepo](https://github.com/egovernments/DIGIT-DevOps/tree/quickstart), you may need to [install git](https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository-from-github/cloning-a-repository) and then run [git clone](https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository-from-github/cloning-a-repository) it to your machine.
   * ```
     git clone -b quickstart https://github.com/egovernments/DIGIT-DevOps 
     ```
2. After cloning the repo CD into the folder DIGIT-DevOps and type the "code ." command that will open the visual editor and opens all the files from the repo DIGIT-DevOps
3.  ```
    cd DIGIT-DevOps/infra-as-code/terraform/ec2-instance
    code .
    ```


4. The following [main.tf ](https://github.com/egovernments/DIGIT-DevOps/blob/quickstart/infra-as-code/terraform/ec2-instance/main.tf)will create ec2 instance.

```
provider "aws" {
  region = "${var.region}"
}
module "ssh_key" {
  source             = "../modules/instance/aws-ec2"
  key_name           =  "${var.key_name}"
  public_key         =  "${var.public_key}"
} 

resource "aws_instance" "k3d-demo" {
  ami                    = "${var.ami_name_value}"
  instance_type          = "${var.instance_type}"
  key_name               = module.ssh_key.ssh_key_name
  monitoring             =  false
  associate_public_ip_address = true
  availability_zone      =  "ap-south-1b"

  tags = {
    Name = "${var.tag}"
  }
}
```

5\.  Update [variables.tf](https://github.com/egovernments/DIGIT-DevOps/blob/quickstart/infra-as-code/terraform/ec2-instance/variables.tf)

```
variable "region" {
  default = "ap-south-1"
}

variable "ami_name_value" {
  default = "ami-0bb9e2d19522c61d4"
}

variable "instance_type" {
  default = "c5.2xlarge"
}


variable "tag" {
    default = "k3d-demo" ## change tag name eg. k3d-demo-your_name
}

## change ssh public_key with your public ssh key
variable "public_key" {
  default = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCrfbaDFN3FmjUoVUx4YH1eHPruFbWz6JGPfSKTwIqT75xFzU/Q6KCa3Xa6FnEOpcUKXej95pkeUnXywohojF6FrNak5p5xfGmmwC8UA9s5UxsI7flBKVnjsAbcRuxoa/AtOzg4Cizz6zQLl2JZAivZU1PwZjIJo8dcum9bjZYVHwZc3csKJ2nYgpcQrV8AWnfKtLvl5WNfNF0i5bWOieNLKiEc5DtsKYbQ6umrhhCaoGcH0S/Gy6w0PPSnnfl/AWXO7ckFtEXQbdz9Y15zeUFKgUsbklXxmC6D37BkPGu+IjCZSOttPV+PRM0Dnf0jQLvMV0UhEkguD9ALC5xikqNlFyPH5bGetWDxtLbn61tnoOIYG6lXAdk2Oe35yWWt3ZgcccWtYuRwDo0ofBwY9jWOkEcCefDyYg+S7h1VzNsbB9DsFv0vPcaxHcZK8bLdyhnz1+9rXy/flbiS5kE0O97aZ4zm4wAmqiivN2wWhUez18k2Mcs= demo@demo" 
  description = "ssh key"
}


variable "key_name" {
  default = "k3d-demo"  ## change ssh key_name eg. k3d-demo-your_name
  description = "ssh key name"
}
```

#### 6. Terraform Execution: <a href="#86fd" id="86fd"></a>

```
cd DIGIT-DevOps/infra-as-code/terraform/ec2-instance
```

```
terraform init
terraform plan
terraform apply
```

7\. The terraform apply command displays the results of creating the resource defined in your configuration files.

```
module.ssh_key.aws_key_pair.ssh_key: Creating...
module.ssh_key.aws_key_pair.ssh_key: Creation complete after 0s [id=k3d-demo]
aws_instance.k3d-demo: Creating...
aws_instance.k3d-demo: Still creating... [10s elapsed]
aws_instance.k3d-demo: Creation complete after 12s [id=i-05764e3b780d836dd]

Apply complete! Resources: 2 added, 0 changed, 0 destroyed.

Outputs:

public_ip = "15.207.14.93"
```

8\. terraform out provided you with vm/instance public IP use same to login.

```
ssh ubuntu@15.207.14.93
NOTE: replace IP 15.207.14.93 with your respective public IP
```

9\. VM/Instance comes with all required k3d dependencies, So you can directly start with the[ ](https://app.gitbook.com/o/-MEQmzNGXk5ajuZujG7E/s/u6Ku4A4oltqY9dhmL6Zu/)[Deployment](2.-deployment.md).
